<!DOCTYPE html>
<html>
<head>
	<title>Spotify Auth Code</title>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<style type="text/css">
		#login, #loggedin {
			/*display: none;*/
		}
		.text-overflow {
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			width: 500px;
		}
	</style>
</head>

<body>
	<div class="container">
		<div id="login">
			<h1>Example Auth Code Flow</h1>
			<a href="/login" class="btn btn-primary">Login in to Spotify</a>
		</div>
		<div id="loggedin">
			<div id="user-profile"></div>
			<div id="oauth"></div>
			<button class="btn btn-default" id="obtain-new-token">Obtain new token with refresh token</button>
		</div>
	</div>

	<script id="loggedin-template" type="text/x-handlebars-template">
	<!-- does this have to be id=user-profile-template? -->
		<h1>Logged in as {{display_name}}</h1>
		<img id="avatar" width="200" src="{{images.0.url}}" />
			<dl class="dl-horizontal">
				<dt>Display name</dt><dd>{{display_name}}</dd>
				<dt>Id</dt><dd>{{id}}</dd>
				<dt>Email</dt><dd>{{email}}</dd>
				<dt>Spotify URI</dt><dd><a href="{{external_urls.spotify}}">{{external_urls.spotify}}</a></dd>
				<dt>link</dt><dd><a href="{{href}}">{{href}}</a></dd>
				<dt>Profile Image</dt><dd><a href="{{images.0.url}}">{{images.0.url}}</a></dd>
			</dl>
			<p><a href="/">Log in again</a></p>
	</script>

	<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script>
		// gets params from url after authorization
		function getUrlParams() {
			console.log("\n\nGETURLPARAMS IN INDEX.HTML\n\n");
			var urlParams = {};
			var e, r = /([^&;=]+)=?([^&;]*)/g,
			var q = window.location.hash.substring(1);
			while ( e = r.exec(q)) {
				urlParams[e[1]] = decodeURIComponent(e[2]);
			}
			return urlParams;
		}

		var params = getUrlParams();

		var access_token = params.access_token;
		var refresh_token = params.refresh_token;
		var error = params.error;

		if (error) {
			alert("Error during authentication: ", error);
		} else {
			console.log("Access token: ", access_token);
			console.log("Refresh token: ", refresh_token);
		};



	</script>

	
</body>
</html>